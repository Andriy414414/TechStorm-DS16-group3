
version: "3.8"

services:
  code:
    build:
      context: .
      dockerfile: Dockerfile
    stdin_open: true # docker run -i
    tty: true        # docker run -t
    ports:
        - "9003:9003"
    volumes:
      - ../Database/django_cache:/tmp/django_cache
    # Health check command
    restart: always
    healthcheck:
      test: ["CMD-SHELL", "curl --fail http://localhost:8000/health/ | grep -q '\"status\": \"ok\"' || exit 1"]
      interval: 60s
      timeout: 5s
      retries: 5
      start_period: 60s  # Delay the first health check by 60 seconds
    environment:
      SECRET_KEY: "${SECRET_KEY}"
      EMAIL_HOST: "${EMAIL_HOST}"
      EMAIL_PORT: "${EMAIL_PORT}"
      EMAIL_HOST_USER: "${EMAIL_HOST_USER}"
      EMAIL_HOST_PASSWORD: "${EMAIL_HOST_PASSWORD}"
      AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
      AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
      AWS_STORAGE_BUCKET_NAME: "${AWS_STORAGE_BUCKET_NAME}"
      AWS_S3_REGION_NAME: "${AWS_S3_REGION_NAME}"
      CLOUDINARY_CLOUD_NAME: "${CLOUDINARY_CLOUD_NAME}"
      CLOUDINARY_API_KEY: "${CLOUDINARY_API_KEY}"
      CLOUDINARY_API_SECRET: "${CLOUDINARY_API_SECRET}"





